#!/usr/bin/env sh
. "$(dirname "$0")/_/husky.sh"

# Block committing env files
if git diff --cached --name-only | grep -E '(^|/)\.env(\..*)?$' >/dev/null 2>&1; then
  echo "\033[31mError: Do not commit .env files.\033[0m"
  exit 1
fi

# Basic secret scan on staged changes (lightweight)
if git diff --cached | grep -E -i '(sk_live|sk_test|aws_secret|-----BEGIN PRIVATE KEY-----|api[_-]?key|xoxp-|ghp_[A-Za-z0-9]{36})' >/dev/null 2>&1; then
  echo "\033[31mPotential secrets detected in staged changes. Commit aborted.\033[0m"
  exit 1
fi

npm run generate:presets
git add src/types/preferences/theme.ts
npx lint-staged
